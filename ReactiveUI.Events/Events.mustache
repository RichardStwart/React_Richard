using System;
using System.Reactive;
using System.Reactive.Linq;

{{#Namespaces}}
using {{Name}};
{{/Namespaces}}

{{#Namespaces}}
namespace {{Name}}
{
    public static class EventsMixin
    {
{{#Types}}
        public static {{Name}}Events Events(this {{Name}} This)
        {
            return new {{Name}}Events(This);
        }
{{/Types}}
    }

{{#Types}}
    public class {{Name}}Events
{{#Parent}}
        : {{Name}}Events
{{/Parent}}
    {
        {{Name}} This;

        public {{Name}}Events({{Name}} This)
{{#Parent}}
            : base(This)
{{/Parent}}
        {
            this.This = This;
        }

{{#Events}}
        public IObservable<{{EventArgsType}}> {{Name}} {
            get { return Observable.FromEventPattern<{{EventHandlerType}}, {{EventArgsType}}>(x => This.{{Name}} += x, x => This.{{Name}} -= x).Select(x => x.EventArgs); }
        }

{{/Events}}
    }
{{/Types}}
}
{{/Namespaces}}

{{#DelegateNamespaces}}
namespace {{Name}}
{
{{#Types}}
    public class Rx{{Name}}
{{#Parent}}
    : Rx{{Name}}
{{/Parent}}
    {
{{#SingleParameterMethods}}
        readonly Subject<{{ParameterType}}> _{{Name}} = new Subject<{{ParameterType}}>();
        public override void {{Name}}({{ParameterType}} {{ParameterName}})
        {
            _{{Name}}.OnNext({{ParameterName}});
        }

{{/SingleParameterMethods}}
{{#MultiParameterMethods}}
        readonly Subject<Tuple<{{ParameterTypeList}}>> _{{Name}} = new Subject<Tuple<{{ParameterTypeList}}>>();
        public override void {{Name}}({{ParameterList}})
        {
            _{{Name}}.OnNext(Tuple.Create({{ParameterNameList}});
        }

{{/MultiParameterMethods}}
    }
{{/Types}}
}
{{/DelegateNamespaces}}